<html>
<head></head><body>

<script type="text/javascript" src="/js/loader.js"></script>

<script type="text/javascript">
window.loader = new Loader;

loader.loadFiles([
    "//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"
    ],
    {async:false});
</script>

<p>As part of my blog redesign (which you'll notice I got distracted from and have not yet finished) I decided to do away with non-vector-based images in posts, which meant it was finally time to replace some old graphs I did in Excel.</p>

<p>Creating bar charts is simple using <a href="http://d3js.org/">d3</a>, but where I encountered an unanticipated difficulty was in replicating the trend lines I threw into the Excel charts.</p>

<p>The problem is that vector graphics aren't designed to draw polynomials <em>per se</em>; rather they draw paths as Bézier curves. I've obviously used Bézier curves before, but I've never actually had to construct one programmatically to describe a precise mathematical formula.</p>

<p>I found <a href="http://www.jasondavies.com/animated-bezier/">this fantastic visualization</a> that explained much more elegantly than words could do how a Bézier curve is built. By staring at these animations for a few minutes it occurred to me how to translate a polynomial into a Bézier curve.</p>

<p>Incidentally, as I was working on this I was at home in Vermont listening to our governor Peter Shumlin give his inaugural address, which focused in part on how poorly Vermont students perform on math tests. Well, here I am, a Vermonter doing math I learned in a Vermont high school. (So maybe you'll have to correct me.)</p>

<p>The graph I was working on first was the graph in my <a href="/2012/10/the-obesity-arc/">presidential BMI post</a>. The trend line is a second-order polynomial, so that's what I'll describe how to create in this post. Higher order polynomials can of course be drawn, and the process is similar. Anyway, here it goes:</p>

<p>The goal is to draw the function</p>

$$f(x) = ax^2 + bx + c, x \in [x_s, x_f]$$

<p>Bézier curves are constructed with two end points and $n-1$ control points, where $n$ is the order of the curve. Thus, a first order Bézier curve is contructed:</p>

$$B(t) = (1-t)P_s + tP_f, t \in [0,1]$$

<p>A second-order Bézier, which is required to draw a a second-order polynomial, is:</p>

$$B(t) = (1-t)[(1-t)P_s + tP_c] + t[(1-t)P_c + tP_f], t \in [0, 1]$$

$$= (1-t)^2P_s + 2(1-t)tP_c + t^2P_f, t \in [0, 1].$$

<p>The challenge for drawing $f(x)$ is to find the appropriate $P_c$. The start and end points $P_s$ and $P_f$ are simply the points along the curve at the domain boundaries, so:</p>

$$P_s = (x_s, f(x_s))$$
$$P_f = (x_f, f(x_f))$$

<p>The control point $P_c$ controls the arc of the curve. It turns out that this point is the intersection of the tangent lines at the start points and end points, as you can see in this diagram.</p>



<p>The intersection is found by setting the equations of the tangent lines at the start and end points equal to one another.</p>

<p>The tangent lines are of course in the form $y = mx + b$. It's helpful to write this in terms of $x$.</p>

<p>The slope $m$ can be found with the derivative $f'(x) = 2ax + b$.</p>

<p>The <em>y</em>-intercepts $b$ can be found by using known points, here $(x_s, y_s)$ and $(x_f, y_f)$.</p>

<p>Thus, the tangent lines at $(x_s, y_s)$ and $(x_f, y_f)$ are:</p>

$$\phi_s(x) = f'(x_s)x + [f(x_s) - f'(x_s)x_s]$$

$$\phi_f(x) = f'(x_f)x + [f(x_f) - f'(x_f)x_f]$$

<p>The intersection is then $x_i \in [x_s, x_f]$ where $\phi_s(x_i) = \phi_f(x_i)$, which can be solved for:</p>

$$f'(x_s)x_i + [f(x_s) - f'(x_s)x_s] = f'(x_f)x_i + [f(x_f) - f'(x_f)x_f]$$

$$[f(x_s) - f'(x_s)x_s] - [f(x_f) - f'(x_f)x_f] = f'(x_f)x_i - f'(x_s)x_i$$

$$[f(x_s) - f'(x_s)x_s] - [f(x_f) - f'(x_f)x_f] = x_i[f'(x_f) - f'(x_s)]$$

$$x_i = \frac{[f(x_s) - f'(x_s)x_s] - [f(x_f) - f'(x_f)x_f]}{f'(x_f) - f'(x_s)}$$

<p>Substituting $f(x)$ and $f'(x)$, the equation can be reduced:</p>

$$x_i = \frac{[(ax_s^2 + bx_s + c) - (2ax_s + b)x_s] - [(ax_f^2 + bx_f + c) - (2x_f + b)x_f]}{(2ax_f + b) - (2ax_s + b)}$$

$$= \frac{ax_s^2 + bx_s + c - 2ax_s^2 - bx_s - ax_f^2 - bx_f - c + 2x_f^2 + bx_f}{2ax_f + b - 2ax_s - b}$$

$$= \frac{ax_f^2 - ax_s^2}{2ax_f - 2ax_s}$$

$$= \frac{x_f^2 - x_s^2}{2(x_f - x_s)}$$

$$= \frac{(x_f - x_s)(x_f + x_s)}{2(x_f - x_s)}$$

$$= \frac{x_f + x_s}{2}$$

<p>Thus, the two tangent lines intersect precisely in the middle of $x_s$ and $x_f$.</p>

<p>To determine the <em>y</em>-coordinate of this intersection $y_i$ it is only necessary to evaluate one of the tangent line equations at $x_i$:</p>

$$y_i = \phi_s(x_i) = f'(x_s)x_i + [f(x_s) - f'(x_s)x_s]$$

<p>Plugging in $f(x)$ and $f'(x)$, this formula becomes:</p>

$$y_i = (2ax_s + b)x_i + [(2ax_s + bx_s + c) - (2ax_s + b)x_s]$$

$$= (2ax_s + bx_s)x_i + 2ax_s + bx_s + c - 2ax_s^2 - bx_s$$

$$= (2ax_s + bx_s)(\frac{x_f + x_s}{2}) + 2ax_s + bx_s + c - 2ax_s^2 - bx_s$$

$$= \frac{2ax^2 + 2ax_sx_f + bx_s + bx_f}{2} - ax_s^2 + c$$

$$= \frac{2ax^2 + 2ax_sx_f + bx_s + bx_f - 2ax_s^2 + 2c}{2}$$

$$= \frac{2ax_sx_f + bx_s + bx_f + 2c}{2}$$

$$= ax_sx_f + \frac{1}{2}b(x_s + x_f) + c.$$

<p>Not quite as neat as deriving $x_i$, but that's not surprising.</p>

<p>To summarize: the intersection of the tangent lines drawn on curve $f(x) = ax^2 + bx + c, x \in [x_s, x_f]$ at the boundaries $x_s$ and $x_f$ is the point $(\frac{x_f + x_s}{2}, ax_sx_f + \frac{1}{2}b(x_s + x_f) + c)$. This is the control point $P_c$ which will draw $f(x)$.</p>

<p>Now the start point, end point, and control point are all known and the Bézier curve can be constructed.</p>

<p>When it comes to drawing vector graphics, the start, end, and control points will of course require a further transformation from the drawn coordinate system to the actual coordinate system used by the image. In pseudo-HTML, the path could be drawn in an SVG like this:</p>

<code><xmp><path d="M x(x_s) y(y_s) Q x(x_c) y(y_c) x(x_f) y(y_f)"></path></xmp></code>

<p>The curve in the diagram above, $f(x) = x^2 - 4x + 4, x \in [0,4]$, is drawn on a 600 x 300 canvas with the path</p>

<code><xmp><path d="M 0 30 Q 300 270 600 30"></path></xmp></code>

<p>And that's it!</p>


</body></html>